
(ns sat-net 

    (:require [gorilla-plot.core :as plot] 

        [anglican.stat :as s])

    (:use clojure.repl

        [anglican core runtime emit 

        [inference :only [collect-by]]]))


    (defm getPrior[u1 u2 u3 val1 val2 val3]
        (let[
            c (cond(or
		          (= u1 val1)
		          (= u2 val2)
		          (= u3 val3))
	          (sample(flip 1.0))
              (and(not= u1 val1)
                  (not= u2 val2)
                  (not= u3 val3))
    	      (sample(flip 0.0)))]c))
    (defm getY[u1 u2]
        (let[
            c (cond(and
                  (= u1 true)
                  (= u2 true))

              (sample(flip 1.0))
              (or(not= u1 true)
                  (not= u2 true))
              (sample(flip 0.0)))]c))
(defquery sat-bayes-net []

     (let [
 	u20 (sample(flip 0.5))
	u19 (sample(flip 0.5))
	u18 (sample(flip 0.5))
	u17 (sample(flip 0.5))
	u16 (sample(flip 0.5))
	u15 (sample(flip 0.5))
	u14 (sample(flip 0.5))
	u13 (sample(flip 0.5))
	u12 (sample(flip 0.5))
	u11 (sample(flip 0.5))
	u10 (sample(flip 0.5))
	u9 (sample(flip 0.5))
	u8 (sample(flip 0.5))
	u7 (sample(flip 0.5))
	u6 (sample(flip 0.5))
	u5 (sample(flip 0.5))
	u4 (sample(flip 0.5))
	u3 (sample(flip 0.5))
	u2 (sample(flip 0.5))
	u1 (sample(flip 0.5))
	c0 (getPrior u1 u2 u13 true false false)
	c1 (getPrior u12 u5 u6 false true true)
	c2 (getPrior u6 u1 u2 true false false)
	c3 (getPrior u6 u14 u8 false false true)
	c4 (getPrior u18 u11 u13 true false true)
	c5 (getPrior u8 u10 u12 true true true)
	c6 (getPrior u18 u17 u6 true false false)
	c7 (getPrior u8 u16 u5 true false true)
	c8 (getPrior u8 u15 u10 false true false)
	c9 (getPrior u3 u7 u13 false true true)
	c10 (getPrior u4 u8 u10 false true false)
	c11 (getPrior u20 u7 u2 false false false)
	c12 (getPrior u17 u15 u5 false true true)
	c13 (getPrior u10 u15 u11 true false true)
	c14 (getPrior u5 u8 u15 false true true)
	c15 (getPrior u9 u4 u14 true false true)
	c16 (getPrior u19 u16 u13 false false false)
	c17 (getPrior u5 u6 u10 true true false)
	c18 (getPrior u8 u11 u16 true true false)
	c19 (getPrior u7 u12 u13 false false false)
	c20 (getPrior u17 u12 u14 true true false)
	c21 (getPrior u9 u20 u13 true true false)
	c22 (getPrior u18 u17 u15 true false true)
	c23 (getPrior u4 u18 u6 false false false)
	c24 (getPrior u2 u4 u9 true false true)
	c25 (getPrior u17 u7 u19 true true true)
	c26 (getPrior u15 u9 u11 false true false)
	c27 (getPrior u2 u13 u15 false true false)
	c28 (getPrior u13 u2 u19 false true false)
	c29 (getPrior u14 u9 u17 false false true)
	c30 (getPrior u18 u20 u2 false false false)
	c31 (getPrior u2 u16 u10 false false true)
	c32 (getPrior u3 u5 u4 false true true)
	c33 (getPrior u4 u7 u10 false false false)
	c34 (getPrior u8 u6 u17 true true true)
	c35 (getPrior u16 u12 u13 false true false)
	c36 (getPrior u5 u16 u19 true true false)
	c37 (getPrior u4 u8 u17 true false false)
	c38 (getPrior u15 u12 u6 true true true)
	c39 (getPrior u2 u14 u19 false true false)
	c40 (getPrior u8 u7 u18 false false true)
	c41 (getPrior u17 u3 u6 true false true)
	c42 (getPrior u14 u18 u13 true false false)
	c43 (getPrior u15 u8 u9 false true true)
	c44 (getPrior u19 u5 u10 true false true)
	c45 (getPrior u20 u6 u14 true false true)
	c46 (getPrior u1 u11 u20 true false false)
	c47 (getPrior u5 u17 u4 false false true)
	c48 (getPrior u6 u3 u4 true false false)
	c49 (getPrior u4 u13 u6 true true false)
	c50 (getPrior u1 u9 u3 false true true)
	c51 (getPrior u20 u3 u1 false false false)
	c52 (getPrior u19 u12 u17 true false true)
	c53 (getPrior u12 u13 u16 false false true)
	c54 (getPrior u16 u10 u6 true false true)
	c55 (getPrior u4 u14 u9 true true false)
	c56 (getPrior u6 u12 u18 false true true)
	c57 (getPrior u19 u5 u17 true true true)
	c58 (getPrior u6 u5 u17 false false true)
	c59 (getPrior u14 u11 u7 true false false)
	c60 (getPrior u20 u6 u19 true true false)
	c61 (getPrior u7 u6 u20 false true true)
	c62 (getPrior u18 u15 u3 true true false)
	c63 (getPrior u18 u19 u14 true false true)
	c64 (getPrior u15 u20 u8 false true true)
	c65 (getPrior u2 u12 u20 false true false)
	c66 (getPrior u16 u20 u4 false true false)
	c67 (getPrior u9 u16 u20 false true true)
	c68 (getPrior u11 u9 u8 false true true)
	c69 (getPrior u20 u13 u2 true true true)
	c70 (getPrior u20 u5 u8 false false false)
	c71 (getPrior u15 u12 u13 true true false)
	c72 (getPrior u18 u14 u15 false true true)
	c73 (getPrior u19 u2 u12 true true false)
	c74 (getPrior u10 u9 u11 true false false)
	c75 (getPrior u8 u17 u13 true false true)
	c76 (getPrior u7 u14 u11 true true true)
	c77 (getPrior u11 u20 u8 true false true)
	c78 (getPrior u9 u17 u2 true true false)
	c79 (getPrior u1 u4 u19 true true true)
	c80 (getPrior u9 u14 u2 true true false)
	c81 (getPrior u18 u7 u12 false true true)
	c82 (getPrior u7 u8 u16 false true true)
	c83 (getPrior u1 u20 u15 false false true)
	c84 (getPrior u14 u15 u1 true false true)
	c85 (getPrior u5 u3 u18 true false false)
	d0(cond(= c0 true)
(sample(flip 1.0))
(= c0 false)
(sample(flip 0.0)))
	d1 (getY d0 c1 )
	d2 (getY d1 c2 )
	d3 (getY d2 c3 )
	d4 (getY d3 c4 )
	d5 (getY d4 c5 )
	d6 (getY d5 c6 )
	d7 (getY d6 c7 )
	d8 (getY d7 c8 )
	d9 (getY d8 c9 )
	d10 (getY d9 c10 )
	d11 (getY d10 c11 )
	d12 (getY d11 c12 )
	d13 (getY d12 c13 )
	d14 (getY d13 c14 )
	d15 (getY d14 c15 )
	d16 (getY d15 c16 )
	d17 (getY d16 c17 )
	d18 (getY d17 c18 )
	d19 (getY d18 c19 )
	d20 (getY d19 c20 )
	d21 (getY d20 c21 )
	d22 (getY d21 c22 )
	d23 (getY d22 c23 )
	d24 (getY d23 c24 )
	d25 (getY d24 c25 )
	d26 (getY d25 c26 )
	d27 (getY d26 c27 )
	d28 (getY d27 c28 )
	d29 (getY d28 c29 )
	d30 (getY d29 c30 )
	d31 (getY d30 c31 )
	d32 (getY d31 c32 )
	d33 (getY d32 c33 )
	d34 (getY d33 c34 )
	d35 (getY d34 c35 )
	d36 (getY d35 c36 )
	d37 (getY d36 c37 )
	d38 (getY d37 c38 )
	d39 (getY d38 c39 )
	d40 (getY d39 c40 )
	d41 (getY d40 c41 )
	d42 (getY d41 c42 )
	d43 (getY d42 c43 )
	d44 (getY d43 c44 )
	d45 (getY d44 c45 )
	d46 (getY d45 c46 )
	d47 (getY d46 c47 )
	d48 (getY d47 c48 )
	d49 (getY d48 c49 )
	d50 (getY d49 c50 )
	d51 (getY d50 c51 )
	d52 (getY d51 c52 )
	d53 (getY d52 c53 )
	d54 (getY d53 c54 )
	d55 (getY d54 c55 )
	d56 (getY d55 c56 )
	d57 (getY d56 c57 )
	d58 (getY d57 c58 )
	d59 (getY d58 c59 )
	d60 (getY d59 c60 )
	d61 (getY d60 c61 )
	d62 (getY d61 c62 )
	d63 (getY d62 c63 )
	d64 (getY d63 c64 )
	d65 (getY d64 c65 )
	d66 (getY d65 c66 )
	d67 (getY d66 c67 )
	d68 (getY d67 c68 )
	d69 (getY d68 c69 )
	d70 (getY d69 c70 )
	d71 (getY d70 c71 )
	d72 (getY d71 c72 )
	d73 (getY d72 c73 )
	d74 (getY d73 c74 )
	d75 (getY d74 c75 )
	d76 (getY d75 c76 )
	d77 (getY d76 c77 )
	d78 (getY d77 c78 )
	d79 (getY d78 c79 )
	d80 (getY d79 c80 )
	d81 (getY d80 c81 )
	d82 (getY d81 c82 )
	d83 (getY d82 c83 )
	d84 (getY d83 c84 )
	y (getY d84 c85 )
]y))(->> (doquery :lmh sat-bayes-net [] :number-of-particles 100)
     (take 10000)
     (collect-by :result)
     (s/empirical-distribution)
     (#(plot/bar-chart (keys %) (vals %))))